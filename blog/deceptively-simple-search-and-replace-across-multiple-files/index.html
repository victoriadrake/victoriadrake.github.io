<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=description content="Victoria Drake, Director of Engineering, is building better systems, processes, and cybersecurity awareness training."><title>Deceptively simple search-and-replace across multiple files | victoria.dev</title><meta name=monetization content="$ilp.uphold.com/pBRfRwg2EJAe"><meta property="og:title" content="Deceptively simple search-and-replace across multiple files - victoria.dev"><meta property="og:type" content="website"><meta property="og:description" content="How to interactively search-and-replace across many files with just two commands, thanks to Vim."><meta property="og:url" content="https://victoria.dev/blog/deceptively-simple-search-and-replace-across-multiple-files/"><meta property="og:site_name" content="victoria.dev"><meta property="og:image" content="https://victoria.dev/blog/deceptively-simple-search-and-replace-across-multiple-files/cover.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Deceptively simple search-and-replace across multiple files"><meta name=twitter:image content="https://victoria.dev/blog/deceptively-simple-search-and-replace-across-multiple-files/cover.png"><meta name=twitter:description content="How to interactively search-and-replace across many files with just two commands, thanks to Vim."><link rel="shortcut icon" href=/img/favicon.ico><link rel=stylesheet href=/css/main.min.80eb7fa9775b9f83b69702058031d472983f96ae7e63e4015f7524886797b90a.css integrity="sha256-gOt/qXdbn4O2lwIFgDHUcpg/lq5+Y+QBX3UkiGeXuQo=" media=screen></head><body><section id=main><div class=header><div class=toggle><input type=checkbox>
<span class=bar></span><span class=bar></span><span class=bar></span><div id=mobile-menu><span class=menu-item><a href=/>ğŸ‘©ğŸ»â€ğŸ’» hi</a></span>
<span class=menu-item><a href=/blog/>ğŸ“° blog</a></span>
<span class=menu-item><a href=/about/>ğŸ“– readme</a></span>
<span class=menu-item><a href=/coffee/><img src=/coffee/cup.png alt="coffee icon" height=16px> contribute</a></span>
<span class=menu-item><a id=rss href=https://victoria.dev/index.xml rel=alternate type=application/rss+xml title="RSS for Deceptively simple search-and-replace across multiple files">ğŸ“¡ rss</a></span></div></div><div id=menu><span class=menu-item><a href=/>ğŸ‘©ğŸ»â€ğŸ’» hi</a></span>
<span class=menu-item><a href=/blog/>ğŸ“° blog</a></span>
<span class=menu-item><a href=/about/>ğŸ“– readme</a></span>
<span class=menu-item><a href=/coffee/><img src=/coffee/cup.png alt="coffee icon" height=16px> contribute</a></span>
<span class=menu-item><a id=rss href=https://victoria.dev/index.xml rel=alternate type=application/rss+xml title="RSS for Deceptively simple search-and-replace across multiple files">ğŸ“¡ rss</a></span></div><div id=logo><a href=#><img id=ğŸ¥š alt="site logo" src=/img/logo.png></a></div></div><div class=container><div id=cover-image><img src=https://victoria.dev/blog/deceptively-simple-search-and-replace-across-multiple-files/cover.png alt="cover image"></div><div class=markdown><h1>Deceptively simple search-and-replace across multiple files</h1><p class=subtitle>How to interactively search-and-replace across many files with just two commands, thanks to Vim.</p><p class=metadata id=date>August 25, 2020
â˜•ï¸&nbsp;
2 min read
&nbsp;
<a class=li-tag href=/tags/terminal/>terminal
</a>&nbsp;
<a class=li-tag href=/tags/linux/>linux
</a>&nbsp;</p></div><div class=page-separator><hr></div><div class=markdown><p>While a multitude of methods exist to search for and replace words in a single file, what do you do when you&rsquo;ve got a string to update across multiple unrelated files, all with different names? You harness the power of command line tools, of course!</p><p>First, you&rsquo;ll need to <code>find</code> all the files you want to change. Stringing together what are effectively search queries for <code>find</code> is really only limited by your imagination. Here&rsquo;s a simple example that finds Python files:</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>find . -name <span class=s1>&#39;*.py&#39;</span>
</code></pre></div><p>The <code>-name</code> test searches for a pattern, such as all files ending in <code>.py</code>, but <code>find</code> can do a lot more with other test conditions, including <code>-regex</code> tests. Run <code>find --help</code> to see the multitude of options.</p><p>Further tune your search by using <code>grep</code> to get only the files that contain the string you want to change, such as by adding:</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>grep -le <span class=s1>&#39;\&lt;a whale\&gt;&#39;</span>
</code></pre></div><p>The <code>-l</code> option gives you just the file names for all files containing a pattern (denoted with <code>-e</code>) that match &ldquo;a whale&rdquo;.</p><p>Using Vim&rsquo;s impressive <code>:bufdo</code> lets you run the same command across multiple buffers, interactively working with all of these files without the tedium of opening, saving, and closing each file, one at a time.</p><p>Let&rsquo;s plug your powerful <code>find</code>+<code>grep</code> results into Vim with:</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>vim <span class=sb>`</span>find . -name <span class=s1>&#39;*.py&#39;</span> <span class=se>\
</span><span class=se></span>-exec grep -le <span class=s1>&#39;\&lt;a whale\&gt;&#39;</span> <span class=o>{}</span> <span class=se>\;</span><span class=sb>`</span>
</code></pre></div><p>Using backtick-expansion to pass our search to Vim opens up multiple buffers ready to go. (Do <code>:h backtick-expansion</code> in Vim for more.) Now you can apply the Vim command <code>:bufdo</code> to all of these files and perform actions such as interactive search-and-replace:</p><div class=highlight><pre class=chroma><code class=language-vim data-lang=vim><span class=p>:</span><span class=nx>bufdo</span> %<span class=nx>s</span><span class=sr>/a whale/</span><span class=nx>a</span> <span class=nx>bowl</span> <span class=nx>of</span> <span class=nx>petunias</span>/<span class=nx>gce</span><span class=err>
</span></code></pre></div><p>The <code>g</code> for &ldquo;global&rdquo; will change occurrences of the pattern on all lines. The <code>e</code> will omit errors if the pattern is not found. The <code>c</code> option makes this interactive; if you&rsquo;re feeling confident, you can omit it to make the changes without reviewing each one.</p><p>If one of the patterns contains a <code>/</code> character, you can substitute the separator in the above command to make it more readable. Vim will assume the character following the <code>%s</code> is the separator, so for example:</p><div class=highlight><pre class=chroma><code class=language-vim data-lang=vim><span class=p>:</span><span class=nx>bufdo</span> %<span class=nx>s_a</span> <span class=nx>whale_a</span> <span class=nx>bowl</span> <span class=nx>of</span> <span class=nx>peonies</span>/<span class=nx>petunias_gce</span><span class=err>
</span></code></pre></div><p>When you&rsquo;ve finished going through all the buffers, save all the work you&rsquo;ve completed with:</p><div class=highlight><pre class=chroma><code class=language-vim data-lang=vim><span class=p>:</span><span class=nx>bufdo</span> <span class=nx>wq</span><span class=p>!</span><span class=err>
</span></code></pre></div><p>Then bask in the glory of your saved time and effort.</p></div><div class=page-separator><hr></div><div class=related><div class="markdown highlight"><pre class=chroma><code class=language-sql data-lang=sql>SELECT TOP 3 * FROM Related;</code></pre></div><ul id=list-items><li><a class=li-link href=https://victoria.dev/blog/command-line-tricks-for-managing-your-messy-open-source-repository/>Command line tricks for managing your messy open source repository</a><p class=li-brief>A handy toolbox for the terminal to help open source maintainers make their projects sparkle.</p><p class=metadata><a class=li-tag href=/tags/terminal/>terminal</a>
â˜•ï¸&nbsp;
5 min read</p></li><li><a class=li-link href=https://victoria.dev/blog/bash-and-shell-expansions-lazy-list-making/>Bash and shell expansions: lazy list-making</a><p class=li-brief>A tour of brace expansion, shell parameter expansions, and playing with substrings in Bash.</p><p class=metadata><a class=li-tag href=/tags/terminal/>terminal</a>
â˜•ï¸&nbsp;
5 min read</p></li><li><a class=li-link href=https://victoria.dev/blog/a-portable-makefile-for-continuous-delivery-with-hugo-and-github-pages/>A portable Makefile for continuous delivery with Hugo and GitHub Pages</a><p class=li-brief>My Makefile for building this site, optimizing images, and running my CI/CD GitHub Actions flow.</p><p class=metadata><a class=li-tag href=/tags/ci/cd/>ci/cd</a>
â˜•ï¸&nbsp;
5 min read</p></li></ul><div class=page-separator><p class=back-link><a href=/blog>&lt;&lt; Back to blog</a></p></div></div></div><div class=container><footer><div class=markdown><figure class=profile><img src=/img/victoria_headshot.jpg alt="Victoria's headshot"></figure><p>Victoria Drake is a Director of Engineering in Washington, DC. She is a core maintainer and co-author for the Open Web Application Security Project (OWASP) Web Security Testing Guide. She earned the annual Top Contributor award two years in a row from the freeCodeCamp non-profit, and is a recognized Distinguished Author on the DEV.to developer platform. She writes about software development, cybersecurity, and information security awareness.</p><p><a href=/about>about</a> - <a href=mailto:hello@victoria.dev>email</a> - <a href=https://github.com/victoriadrake>github</a> - <a href=https://twitter.com/victoriadotdev>twitter</a> - <a href=https://www.linkedin.com/in/victoriadotdev/>linkedin</a></p></div></footer></div></section><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-98623582-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>