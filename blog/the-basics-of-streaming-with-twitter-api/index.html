<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=description content="Victoria Drake is a senior software engineer and Director of Engineering. She builds better systems, processes, and cybersecurity awareness training."><title>The basics of streaming with Twitter API | victoria.dev</title><meta name=monetization content="$ilp.uphold.com/pBRfRwg2EJAe"><meta property="og:title" content="The basics of streaming with Twitter API - victoria.dev"><meta property="og:type" content="website"><meta property="og:description" content="Getting started with Twitter's Streaming API on Windows 10 with Python."><meta property="og:url" content="https://victoria.dev/blog/the-basics-of-streaming-with-twitter-api/"><meta property="og:site_name" content="victoria.dev"><meta property="og:image" content="https://victoria.dev/blog/the-basics-of-streaming-with-twitter-api/twitter-stream.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="The basics of streaming with Twitter API"><meta name=twitter:image content="https://victoria.dev/blog/the-basics-of-streaming-with-twitter-api/twitter-stream.png"><meta name=twitter:description content="Getting started with Twitter's Streaming API on Windows 10 with Python."><link rel="shortcut icon" href=/img/logo.ico><link rel=stylesheet href=/css/main.min.2d2b8306d2a8708f89c48a9e659e883f819ecc121ff5c2bde04559806d49309a.css integrity="sha256-LSuDBtKocI+JxIqeZZ6IP4GezBIf9cK94EVZgG1JMJo=" media=screen></head><body><section id=main><div class=header><div class=toggle><input type=checkbox>
<span class=bar></span><span class=bar></span><span class=bar></span><div id=mobile-menu><span class=menu-item><a href=/>üë©üèª‚Äçüíª hi</a></span>
<span class=menu-item><a href=/blog/>üì∞ blog</a></span>
<span class=menu-item><a href=/about/>üìñ readme</a></span>
<span class=menu-item><a href=/coffee/><img src=/coffee/cup.png alt="coffee icon" height=16px> contribute</a></span></div></div><div id=menu><span class=menu-item><a href=/>üë©üèª‚Äçüíª hi</a></span>
<span class=menu-item><a href=/blog/>üì∞ blog</a></span>
<span class=menu-item><a href=/about/>üìñ readme</a></span>
<span class=menu-item><a href=/coffee/><img src=/coffee/cup.png alt="coffee icon" height=16px> contribute</a></span></div><div id=logo><a href=#><img id=ü•ö alt="site logo" src=/img/logo.png></a></div></div><div class=container><div id=cover-image><img src=https://victoria.dev/blog/the-basics-of-streaming-with-twitter-api/twitter-stream.png alt="cover image"></div><div class=markdown><h1>The basics of streaming with Twitter API</h1><p class=subtitle>Getting started with Twitter's Streaming API on Windows 10 with Python.</p><p class=metadata id=date>January 6, 2017
‚òïÔ∏è&nbsp;
5 min read
&nbsp;
<a class=li-tag href=/tags/api/>api
</a>&nbsp;
<a class=li-tag href=/tags/python/>python
</a>&nbsp;</p></div><div class=page-separator><hr></div><div class=markdown><div id=deprecated>Twitter has begun asking users to <a href=https://developer.twitter.com/en/apply-for-access>apply to use the API</a>, presumably to cut down on <a href=https://developer.twitter.com/en/developer-terms/more-on-restricted-use-cases>unpalatable uses</a>. This article is still relevant, however, no longer represents the best way to get started with Twitter API streaming. For more on the current API, please see the <a href=https://developer.twitter.com/en/docs>Twitter API Docs</a>.</div><p>This post covers my initial adventures in exploring Twitter&rsquo;s Streaming API. I&rsquo;ll talk about:</p><ol><li>Getting started making a Twitter Streaming program using a template</li></ol><ul><li>Problems arising from programming in Python with Windows 10 and Unicode</li><li>Refining the search function</li></ul><p>You can follow along with <a href=https://github.com/victoriadrake/twitter-stream-template>my template on Github</a>.</p><h2 id=1-getting-started class=anchor-link><a href=#1-getting-started>1. Getting started</a></h2><p>If you&rsquo;re new to Twitter&rsquo;s Streaming API like I was this morning, here it is from the top.</p><p>Twitter&rsquo;s <a href=https://dev.twitter.com/streaming/public>Streaming API</a> basically enables you to continually load a stream of tweets based on search parameters of your choosing, as they&rsquo;re created in real time. Using a little Python script run from the Windows 10 command line, you can have these tweets display (print) as they&rsquo;re retrieved, while your script is running. The stream will continually update until you stop the script, which from the terminal is achieved with <code>ctrl+c</code>.</p><p>I started with <a href=https://github.com/adamdrake/twitterstreamtemplate>@adamdrake&rsquo;s twitterstreamtemplate on Github</a>, which makes use of queuing in Python (still a concept I&rsquo;m just getting familiar with, but <a href=https://www.troyfawkes.com/learn-python-multithreading-queues-basics/>this article</a> has a nice basic overview of it). <a href=https://twython.readthedocs.io/en/latest/usage/starting_out.html#starting-out>The Twython 3.4.0 documentation</a> was also very helpful.</p><p>The Twitter API requires authentication, for which you&rsquo;ll need to register an application with Twitter. You can do this here: <a href=https://dev.twitter.com/apps>https://dev.twitter.com/apps</a>s>. Don&rsquo;t worry too much about its name or description if you&rsquo;re just tinkering, like I am. Once you&rsquo;ve registered, you can obtain your new credentials (<code>consumer_key</code>, <code>consumer_secret</code>, <code>token</code>, and <code>token_secret</code>) from the Keys and Access Tokens tab.</p><p>Input your credentials in the appropriate places:</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=c1># Input your credentials below</span>
<span class=n>consumer_key</span> <span class=o>=</span> <span class=s2>&#34;xxx&#34;</span>
<span class=n>consumer_secret</span> <span class=o>=</span> <span class=s2>&#34;xxx&#34;</span>
<span class=n>token</span> <span class=o>=</span> <span class=s2>&#34;xxx&#34;</span>
<span class=n>token_secret</span> <span class=o>=</span> <span class=s2>&#34;xxx&#34;</span>
</code></pre></div><p>You can set parameters to find specific tweets, or just show a sample stream. The relevant lines are:</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=c1># stream.statuses.filter(track=&#39;twitter&#39;, language=&#39;en&#39;)</span>
<span class=n>stream</span><span class=o>.</span><span class=n>statuses</span><span class=o>.</span><span class=n>sample</span><span class=p>(</span><span class=n>language</span><span class=o>=</span><span class=s2>&#34;en&#34;</span><span class=p>)</span>
</code></pre></div><p>As written, it&rsquo;ll show you the sample stream. Switch the commented lines if you want to set your own search parameters. (More on that below.)</p><h2 id=2-hiccups-windows-10-python-and-unicode class=anchor-link><a href=#2-hiccups-windows-10-python-and-unicode>2. Hiccups: Windows 10, Python, and Unicode</a></h2><p>My first pass at this program consisted of two goals: 1) successfully pull up a stream of tweets based on my search parameters, and 2) print them. The relevant line for achieving the second goal is:</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=k>print</span><span class=p>(</span><span class=n>tweet</span><span class=p>)</span>
</code></pre></div><p>I opened up the terminal and typed <code>python tweet_stream.py</code> to run the program. After a brief pause it returned this error:</p><pre><code class=language-system data-lang=system>return codecs.charmap_encode(input,self.errors,encoding_map)[0]
UnicodeEncodeError: 'charmap' codec can't encode characters in position 1270-1271: character maps to &lt;undefined&gt;
</code></pre><p>The short explanation is that Windows 10 doesn&rsquo;t play well with Python&rsquo;s default output encoding, UTF-8. (I&rsquo;m making my way through <a href=https://docs.python.org/3.6/howto/unicode.html>Python&rsquo;s documentation on Unicode</a>, which is rather long but truly fascinating to me.)</p><p>I explored installing a Linux shell with updated Python so I could use Bash. While that&rsquo;s a good eventual idea for programming in general, it&rsquo;s definitely a big diversion from the topic at hand. Instead, I implemented a program-specific fix using a much faster and less complicated method: convert the tweets to ASCII before they display in the Windows 10 terminal.</p><p>This is achieved by changing the encoding of the tweet text:</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=k>print</span><span class=p>(</span><span class=n>tweet</span><span class=p>[</span><span class=s2>&#34;text&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&#34;ascii&#34;</span><span class=p>,</span> <span class=s2>&#34;ignore&#34;</span><span class=p>))</span>
</code></pre></div><p>The above displays the text of the tweets using ASCII encoding, and ignores any characters it can&rsquo;t encode. Instead of <code>ignore</code>, you could also use other handlers to indicate errors. Python documentation gives an example of what these different handlers do <a href=https://docs.python.org/3.6/howto/unicode.html#converting-to-bytes>here</a>.</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>&gt;&gt;&gt; u.encode<span class=o>(</span><span class=s1>&#39;ascii&#39;</span>, <span class=s1>&#39;ignore&#39;</span><span class=o>)</span>
b<span class=s1>&#39;abcd&#39;</span>
&gt;&gt;&gt; u.encode<span class=o>(</span><span class=s1>&#39;ascii&#39;</span>, <span class=s1>&#39;replace&#39;</span><span class=o>)</span>
b<span class=s1>&#39;?abcd?&#39;</span>
&gt;&gt;&gt; u.encode<span class=o>(</span><span class=s1>&#39;ascii&#39;</span>, <span class=s1>&#39;xmlcharrefreplace&#39;</span><span class=o>)</span> <span class=c1># inserts XML character reference</span>
b<span class=s1>&#39;&amp;#40960;abcd&amp;#1972;&#39;</span>
&gt;&gt;&gt; u.encode<span class=o>(</span><span class=s1>&#39;ascii&#39;</span>, <span class=s1>&#39;backslashreplace&#39;</span><span class=o>)</span> <span class=c1># inserts a \uNNNN escape sequence</span>
b<span class=s1>&#39;\\ua000abcd\\u07b4&#39;</span>
&gt;&gt;&gt; u.encode<span class=o>(</span><span class=s1>&#39;ascii&#39;</span>, <span class=s1>&#39;namereplace&#39;</span><span class=o>)</span> <span class=c1># inserts a \N{...} escape sequence</span>
b<span class=s1>&#39;\\N{YI SYLLABLE IT}abcd\\u07b4&#39;</span>
</code></pre></div><p>Now running the program with the Windows 10 terminal should give you&mldr; a <em>lot</em> of tweets. (It&rsquo;ll keep going until you stop the program using <code>ctrl+c</code>. On a couple occassions when my program wasn&rsquo;t finding many tweets, <code>ctrl+c</code> didn&rsquo;t seem to work. I hit it a few more times in succession before it seemed to sync up with the program actually doing something, and stopped the operation.)</p><h2 id=3-refining-the-search-function class=anchor-link><a href=#3-refining-the-search-function>3. Refining the search function</a></h2><p>To retrieve a stream of tweets filtered by your search parameters, you&rsquo;ll want to alter this line of code:</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>stream</span><span class=o>.</span><span class=n>statuses</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>track</span><span class=o>=</span><span class=s2>&#34;twitter&#34;</span><span class=p>,</span> <span class=n>language</span><span class=o>=</span><span class=s2>&#34;en&#34;</span><span class=p>)</span>
</code></pre></div><p>The <code>track</code> parameter is what lets you filter your tweets by keywords, hashtags, user mentions, and urls. In the above example, it will search for tweets containing the keyword &ldquo;twitter&rdquo;. You can find its accepted phrases <a href=https://dev.twitter.com/streaming/overview/request-parameters#track>here</a>. Note that the phrases don&rsquo;t work like search engine phrases - characters in the tweet must exactly match the search phrase, and punctuation within the quotes will be considered part of the phrase. For example, &ldquo;caf√©&rdquo; will not find &ldquo;cafe&rdquo; or vice versa, and &ldquo;hello,&rdquo; is a different phrase than &ldquo;hello&rdquo;.</p><p>The <code>language</code> parameter in the example above limits the search results to tweets written in English. There are further parameters you can use to filter your results, such as follow (which limits your stream to searching the timelines of the users you specify) and location (which can allow you to filter by geolocated tweets). Find the full list of parameters and their values <a href=https://dev.twitter.com/streaming/overview/request-parameters>here</a>.</p><p>I intended to use the <code>track</code> parameter to find tweets containing any one of a list of hashtags. I started out with the code below:</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>stream</span><span class=o>.</span><span class=n>statuses</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>track</span><span class=o>=</span><span class=s2>&#34;#coding,#programming,#travel&#34;</span><span class=p>,</span> <span class=n>language</span><span class=o>=</span><span class=s2>&#34;en&#34;</span><span class=p>)</span>
</code></pre></div><p>Note that the comma separators will cause the program to find tweets that contain any of those search terms: #coding OR #programming, etc. If you want to have your search find tweets containing all your search terms, use spaces only.</p><p>The track function is pretty literal, and thus not very intuitive. For example, my &ldquo;#programming&rdquo; phrase called up tweets that were related to computer programming as well as television programming. While you could set other parameters that omit certain words, it&rsquo;s not long before such an approach turns into a very lengthy guessing game. A cleaner (and faster) approach is to choose more specific search phrases, for example:</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>stream</span><span class=o>.</span><span class=n>statuses</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span>
    <span class=n>track</span><span class=o>=</span><span class=s2>&#34;#coding,#python,#digitalnomad,#laptoplifestyle&#34;</span><span class=p>,</span> <span class=n>language</span><span class=o>=</span><span class=s2>&#34;en&#34;</span>
<span class=p>)</span>
</code></pre></div><p>Your keywords will vary depending on what you want your stream to display. The <a href=https://twitter.com/search-advanced>Twitter Advanced Search page</a> is a good resource for trying out different combinations before running your script.</p><p>I hope you find this overview of my first Twitter streaming script useful! Thanks for reading!</p></div><div class=page-separator><hr></div><div class=related><div class="markdown highlight"><pre class=chroma><code class=language-sql data-lang=sql>SELECT TOP 3 * FROM Related;</code></pre></div><ul id=list-items><li><a class=li-link href=https://victoria.dev/blog/basics-of-iteration-in-python/>Basics of Iteration in Python</a><p class=li-brief>A basic overview of writing effective iterations in Python using for loops, list comprehensions, and map.</p><p class=metadata><a class=li-tag href=/tags/python/>python</a>
‚òïÔ∏è&nbsp;
4 min read</p></li><li><a class=li-link href=https://victoria.dev/blog/writing-efficient-django/>Writing efficient Django</a><p class=li-brief>How to use Django's views, models, and queries to build a better application.</p><p class=metadata><a class=li-tag href=/tags/coding/>coding</a>
‚òïÔ∏è‚òïÔ∏è&nbsp;
6 min read</p></li><li><a class=li-link href=https://victoria.dev/blog/look-mom-im-a-github-action-hero/>Look mom, I'm a GitHub Action Hero</a><p class=li-brief>The GitHub blog interviews me for their GitHub Action Hero series.</p><p class=metadata><a class=li-tag href=/tags/ci/cd/>ci/cd</a>
‚òïÔ∏è&nbsp;
5 min read</p></li></ul><div class=page-separator><p class=back-link><a href=/blog>&lt;&lt; Back to blog</a></p></div></div></div><div class=container><footer><div class=markdown><figure class=profile><img src=/img/victoria_headshot.jpg alt="Victoria's headshot"></figure><p>Victoria Drake is a senior software engineer currently serving as Director of Engineering in Washington, DC. She is a core maintainer and co-author for the Open Web Application Security Project (OWASP) Web Security Testing Guide. She earned the annual Top Contributor award two years in a row from the freeCodeCamp non-profit, and is a recognized Distinguished Author on the DEV.to developer platform. She writes about software development, cybersecurity, and information security awareness.</p><p><a href=/about>about</a> - <a href=mailto:hello@victoria.dev>email</a> - <a href=https://github.com/victoriadrake>github</a> - <a href=https://twitter.com/victoriadotdev>twitter</a> - <a href=https://www.linkedin.com/in/victoriadotdev/>linkedin</a></p></div></footer></div></section><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-98623582-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>