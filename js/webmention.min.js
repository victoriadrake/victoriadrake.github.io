(function(){"use strict";function t(t,e){return document.currentScript.getAttribute("data-"+t)||e}function e(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&quot;")}function n(t){const n=e(t.author&&t.author.name?t.author.name:t.url.split("/")[2]),o=g[t["wm-property"]]||"reacted";let r='<a class="reaction" rel="nofollow ugc" title="'+n+" "+o+'" href="'+t[h]+'">';return t.author&&t.author.photo&&(r+='<img class="webmention__author__img" src="'+e(t.author.photo)+'">'),r+="</a>",r}function o(t){const e=new Date(t),n=e.toString(),o='<span class="webmention__date">'+n.substr(0,15)+"</span>";return o}function r(t){return t.substr(t.indexOf("//"))}function i(t){const e=[],n={};return t.forEach(function(t){const o=r(t.url);n[o]||(e.push(t),n[o]=!0)}),e}function s(t){let r='<h2>Webmentions</h2><ul class="comments">';return t.forEach(function(t){let i,s;if(r+='<li><div class="webmention">',r+='<div class="webmention__meta"><a class="source" rel="nofollow ugc" href="'+t[h]+'">',t.author&&t.author.name?r+=e(t.author.name):r+=e(t.url.split("/")[2]),r+="</a> "+n(t)+" "+o(t.published)+"</div>",t.content&&t.content.text){let n=e(t.content.text);if(p){let t=n.replace(/\s+/g," ").split(" ",p+1);t.length>p&&(t[p-1]+="&hellip;",t=t.slice(0,p),n=t.join(" "))}i="text",s=n}else i="name",s="(mention)";r+='<div class="webmention__content '+i+'">'+s+"</div>",r+="</div></li>"}),r+='</ul><div class="page-separator"><hr /></div>',r}function c(t){let e='<h2>Appreciation</h2><ul class="reacts">';return t.forEach(function(t){e+='<li><div class="webmention">',e+=n(t)}),e}function a(t,e){if(window.fetch)window.fetch(t).then(function(t){return t.status>=200&&t.status<300?Promise.resolve(t):Promise.reject(new Error(t.statusText))}).then(function(t){return t.json()}).then(e).catch(function(t){console.error("Request failed",t)});else{const t=new XMLHttpRequest;t.onload=function(t){e(JSON.parse(t))},t.onerror=function(t){console.error("Request failed",t)}}}const l=t("page-url",window.location.href.replace(/#.*$/,"")),u=t("add-urls",void 0),f=t("data-id","webmentions"),p=t("wordcount"),d=t("max-webmentions",100),h=t("prevent-spoofing")?"wm-source":"url",m=t("sort-by","published"),w=t("sort-dir","up"),g={"in-reply-to":"replied","like-of":"liked","repost-of":"reposted","bookmark-of":"bookmarked","mention-of":"mentioned",rsvp:"RSVPed","follow-of":"followed"};window.addEventListener("load",function(){const t=document.getElementById(f);if(!t)return;const e=[r(l)];u&&u.split("|").forEach(function(t){e.push(r(t))});let n="https://webmention.io/api/mentions.jf2?per-page="+d+"&sort-by="+m+"&sort-dir="+w;e.forEach(function(t){n+="&target[]="+encodeURIComponent("http:"+t)+"&target[]="+encodeURIComponent("https:"+t)}),a(n,function(e){let n="";const o=[],r=[],a={"in-reply-to":o,"like-of":r,"repost-of":r,"bookmark-of":r,"mention-of":o,rsvp:o};e.children.forEach(function(t){const e=a[t["wm-property"]];e&&e.push(t)}),o.length>0&&(n+=s(i(o))),r.length>0&&(n+=c(i(r))),t.innerHTML=n})})})();