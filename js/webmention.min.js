!function(){"use strict";function getCfg(key,dfl){return document.currentScript.getAttribute("data-"+key)||dfl}const refurl=getCfg("page-url",window.location.href.replace(/#.*$/,"")),addurls=getCfg("add-urls",void 0),containerID=getCfg("data-id","webmentions"),textMaxWords=getCfg("wordcount"),maxWebmentions=getCfg("max-webmentions",100),mentionSource=getCfg("prevent-spoofing")?"wm-source":"url",sortBy=getCfg("sort-by","published"),sortDir=getCfg("sort-dir","up"),reactTitle={"in-reply-to":"replied","like-of":"liked","repost-of":"reposted","bookmark-of":"bookmarked","mention-of":"mentioned",rsvp:"RSVPed","follow-of":"followed"},reactEmoji={"in-reply-to":"ğŸ’¬","like-of":"â¤ï¸","repost-of":"ğŸ”„","bookmark-of":"â­ï¸","mention-of":"ğŸ’¬",rsvp:"ğŸ“…","follow-of":"ğŸœ"},rsvpEmoji={yes:"âœ…",no:"âŒ",interested:"ğŸ’¡",maybe:"ğŸ’­"};function entities(text){return text.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&quot;")}function reactImage(r){const who=entities(r.author&&r.author.name?r.author.name:r.url.split("/")[2]),response=reactTitle[r["wm-property"]]||"reacted";let html='<a class="reaction" rel="nofollow ugc" title="'+who+" "+response+'" href="'+r[mentionSource]+'">';return r.author&&r.author.photo&&(html+='<img class="webmention__author__img" src="'+entities(r.author.photo)+'">'),html+=reactEmoji[r["wm-property"]]||"ğŸ’¥",r.rsvp&&rsvpEmoji[r.rsvp]&&(html+="<sub>"+rsvpEmoji[r.rsvp]+"</sub>"),html+="</a>",html}function publishDate(d){const dateObj=new Date(d),date=dateObj.toString(),html='<span class="webmention__date">'+date.substr(0,15)+"</span>";return html}function stripurl(url){return url.substr(url.indexOf("//"))}function dedupe(mentions){const filtered=[],seen={};return mentions.forEach((function(r){const source=stripurl(r.url);seen[source]||(filtered.push(r),seen[source]=!0)})),filtered}function formatComments(comments){let html='<h2>Webmentions</h2><ul class="comments">';return comments.forEach((function(c){let linkclass,linktext;if(html+='<li><div class="webmention">',html+='<div class="webmention__meta"><a class="source" rel="nofollow ugc" href="'+c[mentionSource]+'">',c.author&&c.author.name?html+=entities(c.author.name):html+=entities(c.url.split("/")[2]),html+="</a> "+reactImage(c)+" "+publishDate(c.published)+"</div>",c.content&&c.content.text){let text=entities(c.content.text);if(textMaxWords){let words=text.replace(/\s+/g," ").split(" ",textMaxWords+1);words.length>textMaxWords&&(words[textMaxWords-1]+="&hellip;",words=words.slice(0,textMaxWords),text=words.join(" "))}linkclass="text",linktext=text}else linkclass="name",linktext="(mention)";html+='<div class="webmention__content '+linkclass+'">'+linktext+"</div>",html+="</div></li>"})),html+='</ul><div class="page-separator"><hr /></div>',html}function formatReactions(reacts){let html='<h2>Reactions</h2><ul class="reacts">';return reacts.forEach((function(r){html+='<li><div class="webmention">',html+=reactImage(r)})),html}function getData(url,callback){if(window.fetch)window.fetch(url).then((function(response){return response.status>=200&&response.status<300?Promise.resolve(response):Promise.reject(new Error(response.statusText))})).then((function(response){return response.json()})).then(callback).catch((function(error){console.error("Request failed",error)}));else{const oReq=new XMLHttpRequest;oReq.onload=function(data){callback(JSON.parse(data))},oReq.onerror=function(error){console.error("Request failed",error)}}}window.addEventListener("load",(function(){const container=document.getElementById(containerID);if(!container)return;const pages=[stripurl(refurl)];addurls&&addurls.split("|").forEach((function(url){pages.push(stripurl(url))}));let apiURL="https://webmention.io/api/mentions.jf2?per-page="+maxWebmentions+"&sort-by="+sortBy+"&sort-dir="+sortDir;pages.forEach((function(path){apiURL+="&target[]="+encodeURIComponent("http:"+path)+"&target[]="+encodeURIComponent("https:"+path)})),getData(apiURL,(function(json){let html="";const comments=[],collects=[],mapping={"in-reply-to":comments,"like-of":collects,"repost-of":collects,"bookmark-of":collects,"mention-of":comments,rsvp:comments};json.children.forEach((function(c){const store=mapping[c["wm-property"]];store&&store.push(c)})),comments.length>0&&(html+=formatComments(dedupe(comments))),collects.length>0&&(html+=formatReactions(dedupe(collects))),container.innerHTML=html}))}))}();